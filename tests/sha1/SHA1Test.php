<?php
declare(strict_types=1);
use PHPUnit\Framework\TestCase;
class SHA1Test extends TestCase {
	function testRotateLeft() {
		/**
		 * We use literal 32bit strings here to make the test more transparent.
		 */
		$this->assertEquals("00000000000000000000000000000001", sprintf("%032b", SHA1::rotateLeft(bindec("10000000000000000000000000000000"), 1)));
		$this->assertEquals("00000000000000000000000000000010", sprintf("%032b", SHA1::rotateLeft(bindec("00000000000000000000000000000001"), 1)));
		$this->assertEquals("11111111111111111111111111111111", sprintf("%032b", SHA1::rotateLeft(bindec("11111111111111111111111111111111"), 1)));
		$this->assertEquals("00000000000010001001100010000101", sprintf("%032b", SHA1::rotateLeft(bindec("01000000000000100010011000100001"), 2)));
		$this->assertEquals("01000000000000100010011000100001", sprintf("%032b", SHA1::rotateLeft(bindec("01000000000000100010011000100001"), 32)));
		$this->assertEquals("00100110001000010100000000000010", sprintf("%032b", SHA1::rotateLeft(bindec("01000000000000100010011000100001"), 16)));

	}
	
	function testExpandChunk() {
		$chunk = "The big brown fox jumped over the sleeping and very lazy pugdog.";
		$expected[0] = 1416127776;
		$expected[1] = 1651074848;
		$expected[2] = 1651666807;
		$expected[3] = 1847617135;
		$expected[4] = 2015390325;
		$expected[5] = 1836082532;
		$expected[6] = 544175717;
		$expected[7] = 1914729576;
		$expected[8] = 1696625516;
		$expected[9] = 1701146729;
		$expected[10] = 1852252257;
		$expected[11] = 1852055670;
		$expected[12] = 1702000928;
		$expected[13] = 1818327673;
		$expected[14] = 544240999;
		$expected[15] = 1685022510;
		$expected[16] = 2125858436;
		$expected[17] = 2461534338;
		$expected[18] = 548701338;
		$expected[19] = 654593010;
		$expected[20] = 1594547045;
		$expected[21] = 2802573278;
		$expected[22] = 2222356280;
		$expected[23] = 1480683668;
		$expected[24] = 2784302255;
		$expected[25] = 1000234826;
		$expected[26] = 3888208542;
		$expected[27] = 31984293;
		$expected[28] = 1127026896;
		$expected[29] = 2441687086;
		$expected[30] = 3064995069;
		$expected[31] = 3681951697;
		$expected[32] = 3573370174;
		$expected[33] = 1898185102;
		$expected[34] = 2249340256;
		$expected[35] = 2855642990;
		$expected[36] = 3538647559;
		$expected[37] = 3517142025;
		$expected[38] = 2047717384;
		$expected[39] = 3565458448;
		$expected[40] = 2396302860;
		$expected[41] = 1656735954;
		$expected[42] = 3975534205;
		$expected[43] = 1761634259;
		$expected[44] = 2341699056;
		$expected[45] = 4015217430;
		$expected[46] = 3800108080;
		$expected[47] = 3935039359;
		$expected[48] = 1724979848;
		$expected[49] = 3059663876;
		$expected[50] = 2769218762;
		$expected[51] = 3901693048;
		$expected[52] = 710338551;
		$expected[53] = 2666852234;
		$expected[54] = 4256046233;
		$expected[55] = 3989612692;
		$expected[56] = 873011943;
		$expected[57] = 2157899576;
		$expected[58] = 1598676902;
		$expected[59] = 3047847092;
		$expected[60] = 2276782623;
		$expected[61] = 2295007371;
		$expected[62] = 2561211691;
		$expected[63] = 1834673120;
		$expected[64] = 4265330780;
		$expected[65] = 2379191518;
		$expected[66] = 2056679159;
		$expected[67] = 2077531700;
		$expected[68] = 3137813343;
		$expected[69] = 46809797;
		$expected[70] = 1438042818;
		$expected[71] = 1981759015;
		$expected[72] = 794992561;
		$expected[73] = 3667626785;
		$expected[74] = 2833840851;
		$expected[75] = 3551460212;
		$expected[76] = 4244733588;
		$expected[77] = 2674304762;
		$expected[78] = 3239446915;
		$expected[79] = 3608571674;
		$ints = SHA1::expand($chunk);
		$this->assertEquals($expected, $ints);
	}
	
	function testGetK() {
		$K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];
		for($i=0;$i<80;$i++) {
			$this->assertEquals($K[floor($i/20)], SHA1::getK($i));
		}
	}
	
	function testGetSHA() {
		$input[0] = 1416127776;
		$input[1] = 1651074848;
		$input[2] = 1651666807;
		$input[3] = 1847617135;
		$input[4] = 2015390325;
		$input[5] = 1836082532;
		$input[6] = 544175717;
		$input[7] = 1914729576;
		$input[8] = 1696625516;
		$input[9] = 1701146729;
		$input[10] = 1852252257;
		$input[11] = 1852055670;
		$input[12] = 1702000928;
		$input[13] = 1818327673;
		$input[14] = 544240999;
		$input[15] = 1685022510;
		$input[16] = 2125858436;
		$input[17] = 2461534338;
		$input[18] = 548701338;
		$input[19] = 654593010;
		$input[20] = 1594547045;
		$input[21] = 2802573278;
		$input[22] = 2222356280;
		$input[23] = 1480683668;
		$input[24] = 2784302255;
		$input[25] = 1000234826;
		$input[26] = 3888208542;
		$input[27] = 31984293;
		$input[28] = 1127026896;
		$input[29] = 2441687086;
		$input[30] = 3064995069;
		$input[31] = 3681951697;
		$input[32] = 3573370174;
		$input[33] = 1898185102;
		$input[34] = 2249340256;
		$input[35] = 2855642990;
		$input[36] = 3538647559;
		$input[37] = 3517142025;
		$input[38] = 2047717384;
		$input[39] = 3565458448;
		$input[40] = 2396302860;
		$input[41] = 1656735954;
		$input[42] = 3975534205;
		$input[43] = 1761634259;
		$input[44] = 2341699056;
		$input[45] = 4015217430;
		$input[46] = 3800108080;
		$input[47] = 3935039359;
		$input[48] = 1724979848;
		$input[49] = 3059663876;
		$input[50] = 2769218762;
		$input[51] = 3901693048;
		$input[52] = 710338551;
		$input[53] = 2666852234;
		$input[54] = 4256046233;
		$input[55] = 3989612692;
		$input[56] = 873011943;
		$input[57] = 2157899576;
		$input[58] = 1598676902;
		$input[59] = 3047847092;
		$input[60] = 2276782623;
		$input[61] = 2295007371;
		$input[62] = 2561211691;
		$input[63] = 1834673120;
		$input[64] = 4265330780;
		$input[65] = 2379191518;
		$input[66] = 2056679159;
		$input[67] = 2077531700;
		$input[68] = 3137813343;
		$input[69] = 46809797;
		$input[70] = 1438042818;
		$input[71] = 1981759015;
		$input[72] = 794992561;
		$input[73] = 3667626785;
		$input[74] = 2833840851;
		$input[75] = 3551460212;
		$input[76] = 4244733588;
		$input[77] = 2674304762;
		$input[78] = 3239446915;
		$input[79] = 3608571674;
		$expected[0] = 2562383102;
		$expected[1] = 2562383102;
		$expected[2] = 2562383102;
		$expected[3] = 2562383102;
		$expected[4] = 2562383102;
		$expected[5] = 2562383102;
		$expected[6] = 2562383102;
		$expected[7] = 2562383102;
		$expected[8] = 2562383102;
		$expected[9] = 2562383102;
		$expected[10] = 2562383102;
		$expected[11] = 2562383102;
		$expected[12] = 2562383102;
		$expected[13] = 2562383102;
		$expected[14] = 2562383102;
		$expected[15] = 2562383102;
		$expected[16] = 2562383102;
		$expected[17] = 2562383102;
		$expected[18] = 2562383102;
		$expected[19] = 2562383102;
		$expected[20] = 1732584193;
		$expected[21] = 1732584193;
		$expected[22] = 1732584193;
		$expected[23] = 1732584193;
		$expected[24] = 1732584193;
		$expected[25] = 1732584193;
		$expected[26] = 1732584193;
		$expected[27] = 1732584193;
		$expected[28] = 1732584193;
		$expected[29] = 1732584193;
		$expected[30] = 1732584193;
		$expected[31] = 1732584193;
		$expected[32] = 1732584193;
		$expected[33] = 1732584193;
		$expected[34] = 1732584193;
		$expected[35] = 1732584193;
		$expected[36] = 1732584193;
		$expected[37] = 1732584193;
		$expected[38] = 1732584193;
		$expected[39] = 1732584193;
		$expected[40] = 2562383102;
		$expected[41] = 2562383102;
		$expected[42] = 2562383102;
		$expected[43] = 2562383102;
		$expected[44] = 2562383102;
		$expected[45] = 2562383102;
		$expected[46] = 2562383102;
		$expected[47] = 2562383102;
		$expected[48] = 2562383102;
		$expected[49] = 2562383102;
		$expected[50] = 2562383102;
		$expected[51] = 2562383102;
		$expected[52] = 2562383102;
		$expected[53] = 2562383102;
		$expected[54] = 2562383102;
		$expected[55] = 2562383102;
		$expected[56] = 2562383102;
		$expected[57] = 2562383102;
		$expected[58] = 2562383102;
		$expected[59] = 2562383102;
		$expected[60] = 1732584193;
		$expected[61] = 1732584193;
		$expected[62] = 1732584193;
		$expected[63] = 1732584193;
		$expected[64] = 1732584193;
		$expected[65] = 1732584193;
		$expected[66] = 1732584193;
		$expected[67] = 1732584193;
		$expected[68] = 1732584193;
		$expected[69] = 1732584193;
		$expected[70] = 1732584193;
		$expected[71] = 1732584193;
		$expected[72] = 1732584193;
		$expected[73] = 1732584193;
		$expected[74] = 1732584193;
		$expected[75] = 1732584193;
		$expected[76] = 1732584193;
		$expected[77] = 1732584193;
		$expected[78] = 1732584193;
		$expected[79] = 1732584193;
		$output = array();
		$b = SHA1::H1;
		$c = SHA1::H2;
		$d = SHA1::H3;
		foreach($input as $key => $value) {
			$output[] = SHA1::getSHA($key, $b, $c, $d);
		}
		$this->assertEquals($expected, $output);
	}
}
